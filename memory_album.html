<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›å¿†ç›¸å†Œ - çè—ç¾å¥½æ—¶å…‰</title>
    <style>
        /* çˆ±å¿ƒè£…é¥°ç±» */
        .heart-decoration {
            position: absolute;
            background-color: var(--accent-primary);
            transform: rotate(45deg);
            opacity: 0.1;
            z-index: 0;
        }
        
        .heart-decoration::before,
        .heart-decoration::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: var(--accent-primary);
            border-radius: 50%;
        }
        
        .heart-decoration::before {
            top: -50%;
            left: 0;
        }
        
        .heart-decoration::after {
            top: 0;
            left: -50%;
        }

        :root {
            /* æš–è‰²è°ƒä¸»é¢˜å˜é‡ */
            --bg-primary: #fff9f5;
            --bg-secondary: #fff1e8;
            --bg-tertiary: #ffe6d8;
            --text-primary: #5d3a2a;
            --text-secondary: #8c6754;
            --text-muted: #c0a596;
            --accent-primary: #ff6b6b;
            --accent-secondary: #ff9a8b;
            --success: #f9a826;
            --danger: #e74c3c;
            --warning: #f39c12;
            --border-color: #ffd7b5;
            --shadow-sm: 0 2px 4px rgba(255, 107, 107, 0.1);
            --shadow-md: 0 4px 8px rgba(255, 107, 107, 0.15);
            --shadow-lg: 0 10px 15px -3px rgba(255, 107, 107, 0.15), 0 4px 6px -2px rgba(255, 107, 107, 0.1);
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --spacing-1: 0.25rem;
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-6: 1.5rem;
            --spacing-8: 2rem;
            --spacing-12: 3rem;
        }

        /* æ·±è‰²æš–è‰²è°ƒä¸»é¢˜å˜é‡ */
        .dark-theme {
            --bg-primary: #2d1b16;
            --bg-secondary: #3d241c;
            --bg-tertiary: #4d2d24;
            --text-primary: #ffd7b5;
            --text-secondary: #e6b89c;
            --text-muted: #c0a596;
            --accent-primary: #ff6b6b;
            --accent-secondary: #ff8a7a;
            --success: #f9a826;
            --danger: #ff7675;
            --warning: #ffb74d;
            --border-color: #6d4c41;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        /* å…¨å±€é‡ç½®ä¸åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
        }
        
        /* å…¨å±€çˆ±å¿ƒè£…é¥° */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z' fill='%23ff6b6b' fill-opacity='0.03'/%3E%3C/svg%3E");
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-4);
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            width: 0%;
            transition: width var(--transition-normal);
            border-radius: var(--radius-lg);
        }

        /* ç›¸å†Œå°é¢ */
        .album-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            transition: transform var(--transition-slow);
        }

        /* ç›¸å†Œå†…å®¹ */
        .album-content {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: var(--spacing-4);
        }

        /* ç¼–è¾‘ç›¸å†Œåç§°è¾“å…¥æ¡† */
        .edit-album-name {
            background: transparent;
            border: none;
            color: inherit;
            font-size: 1.3rem;
            font-weight: 600;
            width: 100%;
            padding: var(--spacing-2);
            transition: background-color var(--transition-fast);
            border-radius: var(--radius-sm);
        }

        .edit-album-name:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* æ¶ˆæ¯æ“ä½œæŒ‰é’® */
        .message-actions {
            position: absolute;
            top: var(--spacing-2);
            right: var(--spacing-2);
            display: flex;
            gap: var(--spacing-2);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .message-item:hover .message-actions {
            opacity: 1;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-2) var(--spacing-4);
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            gap: var(--spacing-2);
            text-decoration: none;
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width var(--transition-normal), height var(--transition-normal);
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            filter: brightness(1.1);
        }

        .btn-small {
            padding: var(--spacing-1) var(--spacing-3);
            font-size: 0.85rem;
        }

        .btn-tiny {
            padding: 3px 8px;
            font-size: 0.75rem;
            border-radius: var(--radius-sm);
        }

        /* è‡ªå¾‹è®¡åˆ’é“¾æ¥ */
        header .planner-link {
            display: inline-block;
            background-color: var(--accent-primary);
            color: white;
            padding: var(--spacing-2) var(--spacing-4);
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: var(--spacing-4);
            transition: all var(--transition-fast);
            position: relative;
            z-index: 5;
            cursor: pointer;
        }

        header .planner-link:hover {
            background-color: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .theme-toggle {
            position: fixed;
            top: var(--spacing-4);
            right: var(--spacing-4);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            z-index: 100;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* å¯¼å‡ºå¯¼å…¥æŒ‰é’®ç»„ */
        .export-import {
            margin-top: var(--spacing-6);
            display: flex;
            gap: var(--spacing-3);
            flex-wrap: wrap;
        }

        /* å®¹å™¨æ ·å¼ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-4);
        }

        /* æµªæ¼«å­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Ma+Shan+Zheng&display=swap');
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            text-align: center;
            padding: var(--spacing-8) 0;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-8);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        /* è£…é¥°çˆ±å¿ƒå…ƒç´  */
        .header-hearts {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        /* èƒŒæ™¯æ¸å˜å¢å¼º */
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 40%),
                        radial-gradient(circle at 80% 70%, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 40%);
            z-index: 0;
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: var(--spacing-2);
            font-weight: 600;
            font-family: 'Ma Shan Zheng', cursive;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            letter-spacing: 1px;
            animation: float 6s ease-in-out infinite;
        }

        header .subtitle {
            font-size: 1.3rem;
            opacity: 0.95;
            margin: 0;
            font-family: 'Dancing Script', cursive;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            animation: float 4s ease-in-out infinite 0.5s;
        }
        
        /* æµ®åŠ¨åŠ¨ç”»æ•ˆæœ */
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-8px);
            }
            100% {
                transform: translateY(0px);
            }
        }
        
        /* çˆ±å¿ƒæµ®åŠ¨åŠ¨ç”» */
        @keyframes floatHeart {
            0%, 100% {
                transform: rotate(45deg) translateY(0px) scale(1);
                opacity: 0.1;
            }
            50% {
                transform: rotate(45deg) translateY(-15px) scale(1.05);
                opacity: 0.15;
            }
        }

        /* åˆ›å»ºç›¸å†Œéƒ¨åˆ† */
        .create-album {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            margin-bottom: var(--spacing-8);
            box-shadow: var(--shadow-sm);
            transition: box-shadow var(--transition-fast);
        }

        .create-album:hover {
            box-shadow: var(--shadow-md);
        }

        .create-album h2 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-4);
            color: var(--text-primary);
        }

        /* è¡¨å•ç»„æ ·å¼ */
        .form-group {
            margin-bottom: var(--spacing-4);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-2);
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: var(--spacing-3);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
            resize: vertical;
        }

        .form-group input[type="text"]:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(108, 91, 231, 0.1);
        }

        /* ç›¸å†Œéƒ¨åˆ† */
        .album-section {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
        }

        .album-section h2 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-6);
            color: var(--text-primary);
        }

        /* ç›¸å†Œåˆ—è¡¨ */
        .album-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: var(--spacing-6);
        }

        /* ç›¸å†Œé¡¹ */
        .album-item {
            position: relative;
            background-color: var(--bg-primary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
            aspect-ratio: 1;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        .album-item:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .album-item:hover .album-cover {
            transform: scale(1.05);
        }

        .album-item.has-background {
            position: relative;
        }

        .album-item.has-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.6) 100%);
            z-index: 0;
        }

        .album-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-3);
        }

        .album-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            word-break: break-word;
        }

        .album-actions {
            display: flex;
            gap: var(--spacing-2);
        }

        /* æ— ç›¸å†Œæç¤º */
        .no-albums {
            grid-column: 1 / -1;
            text-align: center;
            padding: var(--spacing-12);
            color: var(--text-muted);
        }

        .no-albums p {
            font-size: 1.1rem;
            margin: 0;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            padding: var(--spacing-4);
        }

        .modal-content {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-6);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-6);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--spacing-4);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            flex-grow: 1;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all var(--transition-fast);
        }

        .close-modal:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* æ¶ˆæ¯è¡¨å• */
        .message-form {
            margin-bottom: var(--spacing-8);
        }

        .message-form h4,
        .image-upload h4 {
            font-size: 1.2rem;
            margin-bottom: var(--spacing-3);
            color: var(--text-primary);
        }

        .text-right {
            text-align: right;
            margin-top: var(--spacing-2);
        }

        /* å›¾ç‰‡ä¸Šä¼  */
        .image-upload {
            margin-bottom: var(--spacing-8);
        }

        .custom-file-upload {
            display: inline-block;
            padding: var(--spacing-3) var(--spacing-6);
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 500;
        }

        .custom-file-upload:hover {
            background-color: var(--border-color);
        }

        input[type="file"] {
            display: none;
        }

        #uploadStatus {
            margin-top: var(--spacing-3);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* å›¾ç‰‡å’Œæ¶ˆæ¯å®¹å™¨ */
        #imagesContainer,
        #messagesContainer {
            margin-top: var(--spacing-2);
        }

        /* å›¾ç‰‡ç½‘æ ¼ - è‡ªé€‚åº”å¤šåˆ—å¸ƒå±€ */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* è‡ªé€‚åº”å¤šåˆ— */
            gap: 12px; /* è®¾ç½®æ°´å¹³é—´è·çº¦1å˜ç±³ */
            margin-top: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        /* å›¾ç‰‡é¡¹ */
        .image-item {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
            aspect-ratio: 1;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-fast);
        }

        .image-item:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .image-item:hover img {
            transform: scale(1.1);
        }

        .delete-image {
            position: absolute;
            top: var(--spacing-1);
            right: var(--spacing-1);
            width: 24px;
            height: 24px;
            background-color: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-fast);
            line-height: 1;
        }

        .image-item:hover .delete-image {
            opacity: 1;
        }

        /* æ¶ˆæ¯é¡¹ */
        .message-item {
            background-color: var(--bg-primary);
            border-radius: var(--radius-md);
            padding: var(--spacing-4);
            margin-bottom: var(--spacing-3);
            position: relative;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-fast);
            border-left: 3px solid var(--accent-primary);
        }

        .message-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }

        .message-time {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: var(--spacing-2);
        }

        .message-content {
            color: var(--text-primary);
            word-break: break-word;
            line-height: 1.5;
        }

        /* æ— ç…§ç‰‡/æ— æ¶ˆæ¯æç¤º */
        #noImages,
        #noMessages {
            text-align: center;
            padding: var(--spacing-6);
            color: var(--text-muted);
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .album-list {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: var(--spacing-4);
            }

            .image-grid {
                grid-template-columns: repeat(2, 1fr); /* ä¸¤åˆ—å¸ƒå±€ */
                gap: 10px;
            }

            header {
                padding: var(--spacing-6) 0;
            }

            header h1 {
                font-size: 2rem;
            }

            .modal-content {
                padding: var(--spacing-4);
            }

            .theme-toggle {
                top: var(--spacing-3);
                right: var(--spacing-3);
                width: 38px;
                height: 38px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-3);
            }

            .album-list {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: var(--spacing-3);
            }

            .image-grid {
                grid-template-columns: 1fr; /* å•åˆ—å¸ƒå±€ */
                gap: 10px;
            }

            header h1 {
                font-size: 2.2rem;
            }
            
            header .subtitle {
                font-size: 1.1rem;
            }

            header .planner-link {
                display: inline-block;
                background-color: var(--accent-primary);
                color: white;
                padding: var(--spacing-2) var(--spacing-4);
                border-radius: var(--radius-md);
                text-decoration: none;
                font-weight: 500;
                margin-bottom: var(--spacing-4);
                transition: all var(--transition-fast);
            }

            header .planner-link:hover {
                background-color: var(--accent-secondary);
                transform: translateY(-2px);
                box-shadow: var(--shadow-md);
            }

            .export-import {
                flex-direction: column;
            }

            .album-actions {
                flex-direction: column;
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: var(--radius-lg);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
        
        /* å›¾ç‰‡æŸ¥çœ‹å™¨æ ·å¼ */
        /* å°çª—å£è§†é¢‘æ’­æ”¾å™¨æ ·å¼ */
        .mini-video-player {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 640px; /* å°çŸ©å½¢çª—å£å®½åº¦ */
            max-width: 90vw;
            height: 400px; /* å°çŸ©å½¢çª—å£é«˜åº¦ */
            max-height: 80vh;
            background-color: var(--bg-color-dark);
            border-radius: var(--radius-md);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 2100; /* æ¯”å…¨å±æŸ¥çœ‹å™¨æ›´é«˜ */
            flex-direction: column;
            overflow: hidden;
        }
        
        .mini-player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-3) var(--spacing-4);
            background-color: var(--bg-color-darker);
            border-bottom: 1px solid var(--border-color);
        }
        
        .mini-player-title {
            color: var(--text-color);
            font-size: var(--font-size-md);
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            margin-right: var(--spacing-2);
        }
        
        .close-mini-player {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color var(--transition-fast);
        }
        
        .close-mini-player:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .mini-player-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-2);
        }
        
        .mini-player-content video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .image-viewer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-4);
        }
        
        .image-viewer-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-viewer img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: var(--radius-md);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s ease;
            transform-origin: center center;
        }
        
        .close-viewer {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color var(--transition-fast);
        }
        
        .close-viewer:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .viewer-navigation {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            font-size: 2rem;
            padding: var(--spacing-2) var(--spacing-3);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: background-color var(--transition-fast);
        }
        
        .viewer-navigation:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        
        .prev-image {
            left: 0;
        }
        
        .next-image {
            right: 0;
        }
        
        .image-caption {
            color: white;
            text-align: center;
            margin-top: var(--spacing-4);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-hearts"></div>
            <h1>æˆ‘ä»¬çš„å›å¿†ç›¸å†Œ</h1>
            <p class="subtitle">è®°å½•ç¾å¥½æ—¶å…‰ï¼Œçè—çè´µå›å¿†</p>
            <div class="current-time" id="currentTime"></div>
            <a href="autonomy_planner.html" class="planner-link">è‡ªå¾‹è®¡åˆ’</a>
            <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
        </header>
        
        <section class="create-album">
            <h2>åˆ›å»ºæ–°ç›¸å†Œ</h2>
            <div class="form-group">
                <label for="albumName">ç›¸å†Œåç§°</label>
                <input type="text" id="albumName" placeholder="è¯·è¾“å…¥ç›¸å†Œåç§°">
            </div>
            <button class="btn" id="createAlbumBtn">åˆ›å»ºç›¸å†Œ</button>
            
            <div class="export-import">
                <button class="btn btn-secondary" id="exportBtn">å¯¼å‡ºæ•°æ®</button>
                <label for="importInput" class="btn btn-secondary">å¯¼å…¥æ•°æ®</label>
                <input type="file" id="importInput" accept=".json" style="display: none;">
            </div>
        </section>
        
        <section class="album-section">
            <h2>æˆ‘çš„ç›¸å†Œ</h2>
            <div class="album-list" id="albumList">
                <div class="no-albums" id="noAlbums">
                    <p>è¿˜æ²¡æœ‰åˆ›å»ºç›¸å†Œï¼Œå¿«æ¥åˆ›å»ºç¬¬ä¸€ä¸ªå›å¿†ç›¸å†Œå§ï¼</p>
                </div>
            </div>
        </section>
    </div>
    
    <!-- å›¾ç‰‡æŸ¥çœ‹å™¨ -->
    <!-- å°çª—å£è§†é¢‘æ’­æ”¾å™¨ -->
        <div class="mini-video-player" id="miniVideoPlayer">
            <div class="mini-player-header">
                <span class="mini-player-title" id="miniPlayerTitle">è§†é¢‘æ’­æ”¾</span>
                <button class="close-mini-player" id="closeMiniPlayer">&times;</button>
            </div>
            <div class="mini-player-content">
                <video id="miniPlayerVideo" controls></video>
            </div>
        </div>
        
        <div class="image-viewer" id="imageViewer">
        <div class="image-viewer-content" id="viewerContent">
        <img id="viewerImage" src="" alt="æŸ¥çœ‹å›¾ç‰‡">
        <button class="close-viewer" id="closeViewer">&times;</button>
        <button class="viewer-navigation prev-image" id="prevImage">â€¹</button>
        <button class="viewer-navigation next-image" id="nextImage">â€º</button>
            <div class="image-caption" id="imageCaption"></div>
        </div>
    </div>
    
    <!-- ç›¸å†Œè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="albumModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <input type="text" class="edit-album-name" id="modalAlbumTitle" value="">
                </h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <div class="message-form">
                <h4>æ·»åŠ ç¥ç¦è¯­</h4>
                <div class="form-group">
                    <label for="messageContent">ç¥ç¦å†…å®¹</label>
                    <textarea id="messageContent" rows="4" placeholder="è¯·è¾“å…¥æ‚¨çš„ç¥ç¦æˆ–å›å¿†..."></textarea>
                </div>
                <div class="text-right">
                    <button class="btn" id="addMessageBtn">æ·»åŠ ç¥ç¦</button>
                </div>
            </div>
            
            <div class="media-upload">
                <h4>ä¸Šä¼ åª’ä½“</h4>
                <label for="mediaUpload" class="custom-file-upload">
                    é€‰æ‹©ç…§ç‰‡/è§†é¢‘/éŸ³é¢‘
                </label>
                <input type="file" id="mediaUpload" accept="image/*,video/*,audio/*" multiple>
                <div class="progress-bar" id="uploadProgressBar" style="display: none;">
                    <div class="progress" id="uploadProgress"></div>
                </div>
                <p id="uploadStatus" style="margin-top: 10px; color: #6c757d; font-size: 0.9rem;"></p>
            </div>
            
            <div class="form-group" style="margin-top: 30px;">
                <h4>ç›¸å†Œç…§ç‰‡</h4>
                <div id="imagesContainer">
                    <p class="no-albums" id="noImages">æš‚æ— ç…§ç‰‡ï¼Œå¿«æ¥ä¸Šä¼ ç¬¬ä¸€å¼ å§ï¼</p>
                    <div class="image-grid" id="imageGrid"></div>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 30px;">
                <h4>ç¥ç¦åˆ—è¡¨</h4>
                <div id="messagesContainer">
                    <p class="no-albums" id="noMessages">æš‚æ— ç¥ç¦ä¿¡æ¯ï¼Œå¿«æ¥æ·»åŠ ç¬¬ä¸€æ¡å§ï¼</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // åˆå§‹åŒ–æ•°æ®å­˜å‚¨
        let albums = [];
        let currentAlbumId = null;
        let isDarkTheme = false;
        
        // å®‰å…¨åœ°åˆå§‹åŒ–ç›¸å†Œæ•°æ®
        try {
            const storedAlbums = localStorage.getItem('memoryAlbums');
            if (storedAlbums) {
                const parsedAlbums = JSON.parse(storedAlbums);
                // éªŒè¯è§£æç»“æœæ˜¯å¦ä¸ºæ•°ç»„
                if (Array.isArray(parsedAlbums)) {
                    albums = parsedAlbums;
                    console.log('æˆåŠŸåŠ è½½', albums.length, 'ä¸ªç›¸å†Œ');
                } else {
                    console.warn('å­˜å‚¨çš„ç›¸å†Œæ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œåˆå§‹åŒ–ä¸ºç©ºæ•°ç»„');
                    // æ¸…ç†é”™è¯¯æ ¼å¼çš„æ•°æ®
                    localStorage.setItem('memoryAlbums', '[]');
                }
            } else {
                console.log('é¦–æ¬¡åŠ è½½ï¼Œæœªæ‰¾åˆ°å­˜å‚¨çš„ç›¸å†Œæ•°æ®');
            }
        } catch (error) {
            console.error('è§£æç›¸å†Œæ•°æ®æ—¶å‡ºé”™:', error);
            // æ¸…ç†é”™è¯¯æ ¼å¼çš„æ•°æ®
            localStorage.setItem('memoryAlbums', '[]');
            albums = [];
        }
        
        // å®‰å…¨åœ°åˆå§‹åŒ–ä¸»é¢˜è®¾ç½®
        try {
            const storedTheme = localStorage.getItem('darkTheme');
            isDarkTheme = storedTheme === 'true';
        } catch (themeError) {
            console.error('åŠ è½½ä¸»é¢˜è®¾ç½®æ—¶å‡ºé”™:', themeError);
            isDarkTheme = false;
        }
        
        // DOM å…ƒç´ 
        const albumNameInput = document.getElementById('albumName');
        const createAlbumBtn = document.getElementById('createAlbumBtn');
        const albumList = document.getElementById('albumList');
        const noAlbums = document.getElementById('noAlbums');
        const albumModal = document.getElementById('albumModal');
        const modalAlbumTitle = document.getElementById('modalAlbumTitle');
        const closeModal = document.getElementById('closeModal');
        const messageContent = document.getElementById('messageContent');
        const addMessageBtn = document.getElementById('addMessageBtn');
        const messagesContainer = document.getElementById('messagesContainer');
        const noMessages = document.getElementById('noMessages');
        const mediaUpload = document.getElementById('mediaUpload'); // ä¿®æ”¹ä¸ºmediaUpload
        const uploadStatus = document.getElementById('uploadStatus');
        const imagesContainer = document.getElementById('imagesContainer');
        const noImages = document.getElementById('noImages');
        const imageGrid = document.getElementById('imageGrid');
        const themeToggle = document.getElementById('themeToggle');
        const exportBtn = document.getElementById('exportBtn');
        const importInput = document.getElementById('importInput');
        const uploadProgressBar = document.getElementById('uploadProgressBar');
        const uploadProgress = document.getElementById('uploadProgress');
        // åª’ä½“æŸ¥çœ‹å™¨å…ƒç´ 
        // å°çª—å£è§†é¢‘æ’­æ”¾å™¨å…ƒç´ å¼•ç”¨
        const miniVideoPlayer = document.getElementById('miniVideoPlayer');
        const miniPlayerVideo = document.getElementById('miniPlayerVideo');
        const miniPlayerTitle = document.getElementById('miniPlayerTitle');
        const closeMiniPlayer = document.getElementById('closeMiniPlayer');
        
        // å›¾ç‰‡æŸ¥çœ‹å™¨å…ƒç´ å¼•ç”¨
        const imageViewer = document.getElementById('imageViewer');
        const viewerContent = document.getElementById('viewerContent');
        const viewerImage = document.getElementById('viewerImage');
        const closeViewer = document.getElementById('closeViewer');
        const prevImage = document.getElementById('prevImage');
        const nextImage = document.getElementById('nextImage');
        const imageCaption = document.getElementById('imageCaption');
        let currentImageIndex = 0; // å½“å‰æŸ¥çœ‹çš„åª’ä½“ç´¢å¼•
        
        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            if (isDarkTheme) {
                document.body.classList.add('dark-theme');
                themeToggle.textContent = 'â˜€ï¸';
            } else {
                document.body.classList.remove('dark-theme');
                themeToggle.textContent = 'ğŸŒ™';
            }
        }
        
        // ä¿å­˜ç›¸å†Œæ•°æ®åˆ° localStorage
        function saveAlbums() {
            try {
                // æ£€æŸ¥albumså˜é‡æ˜¯å¦å­˜åœ¨ä¸”æ˜¯æœ‰æ•ˆå¯¹è±¡
                if (typeof albums === 'undefined' || albums === null) {
                    console.error('ç›¸å†Œæ•°æ®ä¸å­˜åœ¨');
                    return false;
                }
                
                // ç¡®ä¿albumsæ˜¯æ•°ç»„
                const albumsToSave = Array.isArray(albums) ? albums : [];
                
                // å¯¹ç›¸å†Œæ•°æ®è¿›è¡ŒåŸºæœ¬éªŒè¯å’Œæ¸…ç†
                const validatedAlbums = albumsToSave.map(album => {
                    // ç¡®ä¿æ¯ä¸ªç›¸å†Œéƒ½æœ‰å¿…è¦çš„å±æ€§
                    const validatedAlbum = {
                        id: album.id || generateId(),
                        name: album.name || 'æœªå‘½åç›¸å†Œ',
                        description: album.description || '',
                        createTime: album.createTime || new Date().toISOString(),
                        messages: Array.isArray(album.messages) ? album.messages : [],
                        images: Array.isArray(album.images) ? album.images : [],
                        media: Array.isArray(album.media) ? album.media : []
                    };
                    
                    // æ•°æ®è¿ç§»ï¼šå¦‚æœæœ‰æ—§çš„blessingsæ•°æ®ï¼Œè¿ç§»åˆ°messages
                    if (Array.isArray(album.blessings) && album.blessings.length > 0) {
                        // å°†blessingsè½¬æ¢ä¸ºmessagesæ ¼å¼
                        const blessingMessages = album.blessings.map(b => ({
                            id: b.id || generateId(),
                            content: typeof b === 'string' ? b : b.content || '',
                            timestamp: b.timestamp || Date.now()
                        }));
                        validatedAlbum.messages = [...validatedAlbum.messages, ...blessingMessages];
                    }
                    
                    // éªŒè¯åª’ä½“æ•°æ®
                    validatedAlbum.media = validatedAlbum.media.filter(item => {
                        return item && item.url && typeof item.url === 'string';
                    });
                    
                    return validatedAlbum;
                });
                
                // å°è¯•åºåˆ—åŒ–æ•°æ®
                let jsonData;
                try {
                    jsonData = JSON.stringify(validatedAlbums);
                    
                    // æ£€æŸ¥åºåˆ—åŒ–ç»“æœæ˜¯å¦æœ‰æ•ˆ
                    if (!jsonData || jsonData === '[]') {
                        console.warn('åºåˆ—åŒ–åçš„ç›¸å†Œæ•°æ®ä¸ºç©ºæˆ–æ— æ•ˆ');
                    }
                } catch (jsonError) {
                    console.error('ç›¸å†Œæ•°æ®åºåˆ—åŒ–å¤±è´¥:', jsonError);
                    // å°è¯•ä¿®å¤å’Œé‡æ–°åºåˆ—åŒ–
                    const simplifiedAlbums = validatedAlbums.map(album => ({
                        id: album.id,
                        name: album.name,
                        description: album.description,
                        createTime: album.createTime,
                        // å¯¹äºå¯èƒ½å¯¼è‡´åºåˆ—åŒ–é—®é¢˜çš„å¤§å‹å›¾ç‰‡æ•°æ®ï¼Œåªä¿ç•™åŸºæœ¬ä¿¡æ¯
                        images: album.images.slice(0, 5).map(img => ({
                            src: img.src.substring(0, 100) + '...' // æˆªæ–­è¿‡é•¿çš„base64å­—ç¬¦ä¸²
                        }))
                    }));
                    jsonData = JSON.stringify(simplifiedAlbums);
                    console.warn('ä½¿ç”¨ç®€åŒ–æ•°æ®æˆåŠŸåºåˆ—åŒ–');
                }
                
                // ä¿å­˜åˆ°localStorage
                try {
                    localStorage.setItem('memoryAlbums', jsonData);
                    console.log('ç›¸å†Œæ•°æ®ä¿å­˜æˆåŠŸï¼Œå…±ä¿å­˜', validatedAlbums.length, 'ä¸ªç›¸å†Œ');
                    return true;
                } catch (storageError) {
                    console.error('localStorageä¿å­˜å¤±è´¥:', storageError);
                    // å°è¯•æ¸…ç†éƒ¨åˆ†æ•°æ®åé‡æ–°ä¿å­˜
                    if (storageError.name === 'QuotaExceededError') {
                        console.warn('å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œå°è¯•æ¸…ç†è¿‡å¤§çš„ç›¸å†Œæ•°æ®');
                        const reducedAlbums = validatedAlbums.map(album => {
                            const reducedAlbum = { ...album };
                            // åªä¿ç•™æ¯å¼ å›¾ç‰‡çš„å‰200ä¸ªå­—ç¬¦
                            reducedAlbum.images = album.images.map(img => ({
                                src: img.src.substring(0, 200) + '...'
                            }));
                            return reducedAlbum;
                        });
                        const reducedData = JSON.stringify(reducedAlbums);
                        localStorage.setItem('memoryAlbums', reducedData);
                        console.warn('å·²ä¿å­˜ç®€åŒ–ç‰ˆæœ¬çš„æ•°æ®');
                        return true;
                    }
                    return false;
                }
            } catch (error) {
                console.error('ä¿å­˜ç›¸å†Œæ•°æ®æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯:', error);
                return false;
            }
        }
        
        // ç”Ÿæˆå”¯ä¸€ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatDate(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }
        
        // å›¾ç‰‡å‹ç¼©å‡½æ•°
        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve, reject) => {
                try {
                    // å‚æ•°éªŒè¯å’Œè°ƒæ•´
                    maxWidth = parseInt(maxWidth) || 800;
                    quality = parseFloat(quality) || 0.7;
                    
                    // ç¡®ä¿è´¨é‡åœ¨åˆç†èŒƒå›´å†…
                    quality = Math.min(Math.max(quality, 0.1), 1.0);
                    
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const img = new Image();
                            
                            img.onload = () => {
                                try {
                                    const canvas = document.createElement('canvas');
                                    let width = img.width;
                                    let height = img.height;
                                    
                                    // è°ƒæ•´å›¾ç‰‡å°ºå¯¸ï¼Œä¿æŒå®½é«˜æ¯”
                                    if (width > maxWidth) {
                                        height = (height * maxWidth) / width;
                                        width = maxWidth;
                                    }
                                    
                                    // ç¡®ä¿å®½åº¦å’Œé«˜åº¦ä¸ºæ•´æ•°
                                    canvas.width = Math.round(width);
                                    canvas.height = Math.round(height);
                                    
                                    const ctx = canvas.getContext('2d');
                                    
                                    // æ£€æŸ¥ç”»å¸ƒä¸Šä¸‹æ–‡æ˜¯å¦åˆ›å»ºæˆåŠŸ
                                    if (!ctx) {
                                        throw new Error('æ— æ³•åˆ›å»ºç”»å¸ƒä¸Šä¸‹æ–‡');
                                    }
                                    
                                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                                    
                                    // å°è¯•å‹ç¼©å›¾ç‰‡
                                    try {
                                        // ä½¿ç”¨åŸå§‹æ–‡ä»¶ç±»å‹æˆ–é»˜è®¤JPEG
                                        const imageType = file.type && file.type.startsWith('image/') ? file.type : 'image/jpeg';
                                        const compressedDataUrl = canvas.toDataURL(imageType, quality);
                                        
                                        // æ£€æŸ¥å‹ç¼©åçš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ
                                        if (compressedDataUrl && compressedDataUrl.length > 0) {
                                            resolve(compressedDataUrl);
                                        } else {
                                            throw new Error('ç”Ÿæˆçš„å›¾ç‰‡æ•°æ®æ— æ•ˆ');
                                        }
                                    } catch (compressError) {
                                        console.warn('å‹ç¼©å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨æ›´ä½è´¨é‡é‡æ–°å‹ç¼©:', compressError);
                                        // å°è¯•ä½¿ç”¨æ›´ä½çš„è´¨é‡é‡æ–°å‹ç¼©
                                        const fallbackDataUrl = canvas.toDataURL('image/jpeg', 0.5);
                                        resolve(fallbackDataUrl);
                                    }
                                } catch (error) {
                                    console.error('å›¾ç‰‡å¤„ç†å¤±è´¥:', error);
                                    // å‡ºé”™æ—¶è¿”å›åŸå§‹å›¾ç‰‡æ•°æ®
                                    if (e.target && e.target.result) {
                                        resolve(e.target.result);
                                    } else {
                                        reject(new Error('å›¾ç‰‡å¤„ç†å¤±è´¥ä¸”æ— æ³•è·å–åŸå§‹æ•°æ®'));
                                    }
                                }
                            };
                            
                            img.onerror = (imgError) => {
                                console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', imgError);
                                reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                            };
                            
                            // æ£€æŸ¥e.targetå’Œe.target.resultæ˜¯å¦å­˜åœ¨
                            if (e.target && e.target.result) {
                                img.src = e.target.result;
                            } else {
                                reject(new Error('è¯»å–çš„å›¾ç‰‡æ•°æ®æ— æ•ˆ'));
                            }
                        } catch (error) {
                            console.error('å›¾ç‰‡å¤„ç†è¿‡ç¨‹ä¸­å‡ºé”™:', error);
                            reject(error);
                        }
                    };
                    
                    reader.onerror = (error) => {
                        console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', error);
                        reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
                    };
                    
                    // ç¡®ä¿fileå¯¹è±¡æœ‰æ•ˆ
                    if (file && file instanceof Blob) {
                        reader.readAsDataURL(file);
                    } else {
                        reject(new Error('æ— æ•ˆçš„æ–‡ä»¶å¯¹è±¡'));
                    }
                } catch (error) {
                    console.error('å‹ç¼©å›¾ç‰‡åˆå§‹åŒ–å¤±è´¥:', error);
                    reject(error);
                }
            });
        }
        
        // åˆ›å»ºæ–°ç›¸å†Œ
        function createAlbum() {
            const name = albumNameInput.value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥ç›¸å†Œåç§°');
                return;
            }
            
            const newAlbum = {
                id: generateId(),
                name,
                messages: [],
                images: [],
                media: []
            };
            
            albums.push(newAlbum);
            saveAlbums();
            albumNameInput.value = '';
            renderAlbumList();
        }
        
        // æ¸²æŸ“ç›¸å†Œåˆ—è¡¨
        function renderAlbumList() {
            if (albums.length === 0) {
                noAlbums.style.display = 'block';
                albumList.innerHTML = '';
                return;
            }
            
            noAlbums.style.display = 'none';
            albumList.innerHTML = '';
            
            albums.forEach(album => {
                const albumElement = document.createElement('div');
                albumElement.className = 'album-item';
                
                // ç¡®ä¿album.imagesæ˜¯æ•°ç»„ï¼ˆå‘åå…¼å®¹ï¼‰
                if (!album.images) {
                    album.images = [];
                }
                
                // ç¡®ä¿album.messagesæ˜¯æ•°ç»„
                if (!album.messages) {
                    album.messages = [];
                }
                
                // è·å–åª’ä½“æ•°ç»„ï¼ˆä¼˜å…ˆä½¿ç”¨mediaï¼Œå…¼å®¹æ—§ç‰ˆçš„imagesï¼‰
                const mediaArray = album.media || album.images;
                
                // å¦‚æœç›¸å†Œæœ‰åª’ä½“æ–‡ä»¶ï¼Œè®¾ç½®ç¬¬ä¸€å¼ å›¾ç‰‡ä¸ºèƒŒæ™¯
                const firstImage = mediaArray.find(item => 
                    item.type === 'image' || 
                    (!item.type && item.url.includes('data:image/'))
                );
                
                if (firstImage) {
                    albumElement.classList.add('has-background');
                    albumElement.style.backgroundImage = `url('${firstImage.url}')`;
                }
                
                // åˆ›å»ºç›¸å†Œå†…å®¹åŒºåŸŸ
                const albumContent = document.createElement('div');
                albumContent.className = 'album-content';
                
                // åˆ›å»ºç›¸å†Œå¤´éƒ¨
                const header = document.createElement('div');
                header.className = 'album-header';
                
                const title = document.createElement('h3');
                title.className = 'album-title';
                title.textContent = album.name;
                
                const actions = document.createElement('div');
                actions.className = 'album-actions';
                
                const viewBtn = document.createElement('button');
                viewBtn.className = 'btn btn-small btn-secondary view-album';
                viewBtn.setAttribute('data-id', album.id);
                viewBtn.textContent = 'æŸ¥çœ‹';
                viewBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const albumId = e.currentTarget.getAttribute('data-id');
                    openAlbumModal(albumId);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-small btn-danger delete-album';
                deleteBtn.setAttribute('data-id', album.id);
                deleteBtn.textContent = 'åˆ é™¤';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const albumId = e.currentTarget.getAttribute('data-id');
                    deleteAlbum(albumId);
                });
                
                actions.appendChild(viewBtn);
                actions.appendChild(deleteBtn);
                header.appendChild(title);
                header.appendChild(actions);
                
                const messageCount = document.createElement('p');
                messageCount.textContent = `ç¥ç¦æ•°é‡: ${album.messages.length}`;
                
                const mediaCount = document.createElement('p');
                mediaCount.textContent = `åª’ä½“æ•°é‡: ${mediaArray.length}`;
                
                albumContent.appendChild(header);
                albumContent.appendChild(messageCount);
                albumContent.appendChild(mediaCount);
                
                albumElement.appendChild(albumContent);
                albumList.appendChild(albumElement);
            });
        }
        
        // æ‰“å¼€ç›¸å†Œè¯¦æƒ…æ¨¡æ€æ¡†
        function openAlbumModal(albumId) {
            currentAlbumId = albumId;
            const album = albums.find(a => a.id === albumId);
            
            if (!album) return;
            
            modalAlbumTitle.value = album.name;
            renderMessages(album.messages);
            // è·å–åª’ä½“æ•°ç»„ï¼ˆä¼˜å…ˆä½¿ç”¨mediaï¼Œå…¼å®¹æ—§ç‰ˆçš„imagesï¼‰
            const mediaArray = album.media || album.images || [];
            renderMediaList(mediaArray);
            albumModal.style.display = 'flex';
            messageContent.value = '';
            uploadStatus.textContent = '';
        }
        
        // æ¸²æŸ“ç¥ç¦åˆ—è¡¨
        function renderMessages(messages) {
            // æ¸…ç©ºå®¹å™¨ï¼Œä½†ä¿ç•™noMessageså…ƒç´ 
            Array.from(messagesContainer.children).forEach(child => {
                if (child.id !== 'noMessages') {
                    messagesContainer.removeChild(child);
                }
            });
            
            if (messages.length === 0) {
                noMessages.style.display = 'block';
                return;
            }
            
            noMessages.style.display = 'none';
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            const sortedMessages = [...messages].sort((a, b) => b.timestamp - a.timestamp);
            
            sortedMessages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message-item';
                messageElement.innerHTML = `
                    <div class="message-time">${formatDate(msg.timestamp)}</div>
                    <div class="message-content">${msg.content}</div>
                    <div class="message-actions">
                        <button class="btn btn-tiny btn-danger delete-message" data-id="${msg.id}">åˆ é™¤</button>
                    </div>
                `;
                messagesContainer.appendChild(messageElement);
            });
            
            // ç»‘å®šåˆ é™¤æ¶ˆæ¯äº‹ä»¶
            document.querySelectorAll('.delete-message').forEach(button => {
                button.addEventListener('click', (e) => {
                    const messageId = e.currentTarget.getAttribute('data-id');
                    deleteMessage(messageId);
                });
            });
        }
        
        // æ·»åŠ ç¥ç¦æ¶ˆæ¯
        function addMessage() {
            const content = messageContent.value.trim();
            if (!content) {
                alert('è¯·è¾“å…¥ç¥ç¦å†…å®¹');
                return;
            }
            
            const album = albums.find(a => a.id === currentAlbumId);
            if (!album) return;
            
            const newMessage = {
                id: generateId(),
                content,
                timestamp: Date.now()
            };
            
            // ç¡®ä¿messagesæ•°ç»„å­˜åœ¨
            if (!album.messages) {
                album.messages = [];
            }
            
            album.messages.push(newMessage);
            saveAlbums();
            renderMessages(album.messages);
            renderAlbumList(); // æ›´æ–°ç›¸å†Œåˆ—è¡¨ä¸­çš„ç¥ç¦æ•°é‡
            messageContent.value = '';
        }
        
        // åˆ é™¤ç¥ç¦æ¶ˆæ¯
        function deleteMessage(messageId) {
            const album = albums.find(a => a.id === currentAlbumId);
            if (!album || !album.messages) return;
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¥ç¦å—ï¼Ÿ')) {
                album.messages = album.messages.filter(msg => msg.id !== messageId);
                saveAlbums();
                renderMessages(album.messages);
                renderAlbumList();
            }
        }
        
        // æ¸²æŸ“åª’ä½“åˆ—è¡¨ï¼ˆæ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ï¼‰
        function renderMediaList(mediaItems) {
            imageGrid.innerHTML = '';
            
            if (mediaItems.length === 0) {
                noImages.style.display = 'block';
                return;
            }
            
            noImages.style.display = 'none';
            
            mediaItems.forEach(media => {
                const mediaElement = document.createElement('div');
                mediaElement.className = 'media-item';
                mediaElement.setAttribute('data-id', media.id);
                
                // ç¡®ä¿åª’ä½“å¯¹è±¡æœ‰typeå±æ€§
                const mediaType = media.type || (media.url.includes('data:image/') ? 'image' : 
                                  media.url.includes('data:video/') ? 'video' : 
                                  media.url.includes('data:audio/') ? 'audio' : 'image');
                
                let mediaTag;
                let thumbnail;
                
                if (mediaType === 'image') {
                    // å›¾ç‰‡ç±»å‹
                    mediaTag = document.createElement('img');
                    mediaTag.src = media.url;
                    mediaTag.alt = 'ç›¸å†Œç…§ç‰‡';
                } else if (mediaType === 'video') {
                    // è§†é¢‘ç±»å‹
                    mediaTag = document.createElement('video');
                    mediaTag.src = media.url;
                    mediaTag.controls = false;
                    mediaTag.poster = media.thumbnail || ''; // ä½¿ç”¨ç¼©ç•¥å›¾ï¼ˆå¦‚æœæœ‰ï¼‰
                    
                    // åˆ›å»ºè§†é¢‘æ’­æ”¾æŒ‰é’®è¦†ç›–å±‚
                    thumbnail = document.createElement('div');
                    thumbnail.className = 'video-thumbnail';
                    thumbnail.innerHTML = '<i class="play-icon">â–¶</i>';
                } else if (mediaType === 'audio') {
                    // éŸ³é¢‘ç±»å‹
                    mediaTag = document.createElement('div');
                    mediaTag.className = 'audio-item';
                    mediaTag.innerHTML = `<div class="audio-icon">ğŸµ</div><div class="audio-name">${media.name || 'éŸ³é¢‘æ–‡ä»¶'}</div>`;
                }
                
                mediaTag.title = formatDate(media.timestamp);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-media';
                deleteBtn.setAttribute('data-id', media.id);
                deleteBtn.textContent = 'Ã—';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const mediaId = e.currentTarget.getAttribute('data-id');
                    deleteMedia(mediaId);
                });
                
                // æ ‡ç­¾å®¹å™¨
                const tagsContainer = document.createElement('div');
                tagsContainer.className = 'tags-container';
                
                // æ˜¾ç¤ºç°æœ‰æ ‡ç­¾
                if (media.tags && media.tags.length > 0) {
                    media.tags.forEach(tag => {
                        const tagElement = document.createElement('span');
                        tagElement.className = 'tag';
                        tagElement.textContent = tag;
                        tagsContainer.appendChild(tagElement);
                    });
                }
                
                // æ·»åŠ æ ‡ç­¾æŒ‰é’®
                const addTagBtn = document.createElement('button');
                addTagBtn.className = 'add-tag-btn';
                addTagBtn.textContent = '+';
                addTagBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // åˆ›å»ºä¸€ä¸ªç®€å•çš„è¾“å…¥æ¨¡æ€æ¡†
                    const modalContainer = document.createElement('div');
                    modalContainer.className = 'tag-input-modal';
                    modalContainer.innerHTML = `
                        <div class="tag-input-overlay">
                            <div class="tag-input-content">
                                <h4>æ·»åŠ æ ‡ç­¾</h4>
                                <input type="text" class="tag-input-field" placeholder="è¯·è¾“å…¥æ ‡ç­¾å†…å®¹">
                                <div class="tag-input-buttons">
                                    <button class="tag-input-confirm">ç¡®å®š</button>
                                    <button class="tag-input-cancel">å–æ¶ˆ</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // æ·»åŠ æ ·å¼
                    const style = document.createElement('style');
                    style.textContent = `
                        .tag-input-modal {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            z-index: 1000;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                        .tag-input-overlay {
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-color: rgba(0, 0, 0, 0.5);
                        }
                        .tag-input-content {
                            position: relative;
                            background: white;
                            border-radius: 8px;
                            padding: 20px;
                            width: 90%;
                            max-width: 400px;
                            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                            z-index: 1001;
                        }
                        .dark-theme .tag-input-content {
                            background: #333;
                            color: white;
                        }
                        .tag-input-field {
                            width: 100%;
                            padding: 10px;
                            margin: 10px 0;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            font-size: 16px;
                            box-sizing: border-box;
                        }
                        .dark-theme .tag-input-field {
                            background: #555;
                            border-color: #777;
                            color: white;
                        }
                        .tag-input-buttons {
                            display: flex;
                            justify-content: flex-end;
                            gap: 10px;
                            margin-top: 15px;
                        }
                        .tag-input-confirm, .tag-input-cancel {
                            padding: 8px 16px;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                            font-size: 14px;
                        }
                        .tag-input-confirm {
                            background: #3498db;
                            color: white;
                        }
                        .tag-input-cancel {
                            background: #ecf0f1;
                            color: #333;
                        }
                        .dark-theme .tag-input-cancel {
                            background: #555;
                            color: #eee;
                        }
                    `;
                    document.head.appendChild(style);
                    document.body.appendChild(modalContainer);
                    
                    // è·å–å…ƒç´ å¼•ç”¨
                    const inputField = modalContainer.querySelector('.tag-input-field');
                    const confirmBtn = modalContainer.querySelector('.tag-input-confirm');
                    const cancelBtn = modalContainer.querySelector('.tag-input-cancel');
                    const overlay = modalContainer.querySelector('.tag-input-overlay');
                    
                    // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
                    inputField.focus();
                    
                    // ç¡®è®¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                    confirmBtn.addEventListener('click', () => {
                        const tagText = inputField.value;
                        if (tagText && tagText.trim()) {
                            addTagToMedia(media.id, tagText.trim());
                        }
                        document.body.removeChild(modalContainer);
                        document.head.removeChild(style);
                    });
                    
                    // å–æ¶ˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
                    cancelBtn.addEventListener('click', () => {
                        document.body.removeChild(modalContainer);
                        document.head.removeChild(style);
                    });
                    
                    // ç‚¹å‡»é®ç½©å±‚å…³é—­
                    overlay.addEventListener('click', () => {
                        document.body.removeChild(modalContainer);
                        document.head.removeChild(style);
                    });
                    
                    // æŒ‰Enterç¡®è®¤ï¼ŒæŒ‰ESCå–æ¶ˆ
                    inputField.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            confirmBtn.click();
                        } else if (e.key === 'Escape') {
                            cancelBtn.click();
                        }
                    });
                });
                
                // åˆ›å»ºåª’ä½“å†…å®¹å®¹å™¨
                const mediaContent = document.createElement('div');
                mediaContent.className = 'media-content';
                
                if (mediaType === 'video') {
                    const videoWrapper = document.createElement('div');
                    videoWrapper.className = 'video-wrapper';
                    videoWrapper.appendChild(mediaTag);
                    videoWrapper.appendChild(thumbnail);
                    mediaContent.appendChild(videoWrapper);
                } else {
                    mediaContent.appendChild(mediaTag);
                }
                
                // æ·»åŠ åˆ é™¤æŒ‰é’®å’Œæ ‡ç­¾æŒ‰é’®åˆ°åª’ä½“å†…å®¹å®¹å™¨
                mediaContent.appendChild(deleteBtn);
                mediaContent.appendChild(addTagBtn);
                
                // å°†åª’ä½“å†…å®¹å®¹å™¨å’Œæ ‡ç­¾å®¹å™¨æ·»åŠ åˆ°åª’ä½“é¡¹
                mediaElement.appendChild(mediaContent);
                mediaElement.appendChild(tagsContainer);
                
                imageGrid.appendChild(mediaElement);
                
                // ç‰¹åˆ«ä¸ºè§†é¢‘çš„ç¼©ç•¥å›¾æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç¡®ä¿æ ‡ç­¾æ·»åŠ åŠŸèƒ½åœ¨è§†é¢‘ä¸Šä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨
                if (mediaType === 'video' && thumbnail) {
                    addTagBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // è§¦å‘ä¸Šé¢å·²ç»å®šä¹‰çš„æ ‡ç­¾æ·»åŠ é€»è¾‘
                    });
                }
                
                // æ·»åŠ ç‚¹å‡»æŸ¥çœ‹äº‹ä»¶
                mediaElement.addEventListener('click', (e) => {
                    if (!e.target.closest('.delete-media') && !e.target.closest('.add-tag-btn')) {
                        e.stopPropagation();
                        const album = albums.find(a => a.id === currentAlbumId);
                        if (album && album.media) {
                            currentImageIndex = album.media.findIndex(mediaItem => mediaItem.id === media.id);
                            openMediaViewer(album.media);
                        } else if (album && album.images) {
                            // å…¼å®¹æ—§æ•°æ®ç»“æ„
                            currentImageIndex = album.images.findIndex(mediaItem => mediaItem.id === media.id);
                            openMediaViewer(album.images);
                        }
                    }
                });
            });
        }
        
        // å¤„ç†åª’ä½“ä¸Šä¼  - æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘
        async function handleMediaUpload(e) {
            const files = e.target.files;
            if (files.length === 0) return;
            
            const album = albums.find(a => a.id === currentAlbumId);
            if (!album) return;
            
            // åˆ›å»ºmediaæ•°ç»„ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼Œå¹¶å…¼å®¹æ—§çš„imagesæ•°ç»„
            if (!album.media) {
                // å¦‚æœæœ‰æ—§çš„imagesæ•°ç»„ï¼Œè¿ç§»åˆ°mediaæ•°ç»„
                album.media = album.images || [];
                // ä¸ºè¿ç§»çš„å…ƒç´ æ·»åŠ ç±»å‹ä¿¡æ¯
                album.media.forEach(item => {
                    if (!item.type) {
                        item.type = 'image';
                    }
                });
            }
            
            uploadStatus.textContent = `æ­£åœ¨å¤„ç† ${files.length} ä¸ªåª’ä½“æ–‡ä»¶...`;
            uploadProgressBar.style.display = 'block';
            uploadProgress.style.width = '0%';
            
            let processedCount = 0;
            let successfullyAdded = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // æ›´æ–°è¿›åº¦
                processedCount++;
                uploadProgress.style.width = `${(processedCount / files.length) * 100}%`;
                uploadStatus.textContent = `æ­£åœ¨å¤„ç†ç¬¬ ${processedCount} ä¸ªæ–‡ä»¶...`;
                
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                let mediaType;
                if (file.type.startsWith('image/')) {
                    mediaType = 'image';
                } else if (file.type.startsWith('video/')) {
                    mediaType = 'video';
                } else if (file.type.startsWith('audio/')) {
                    mediaType = 'audio';
                } else {
                    uploadStatus.textContent = `æ–‡ä»¶ ${file.name} ä¸æ˜¯æ”¯æŒçš„åª’ä½“ç±»å‹ï¼ˆå›¾ç‰‡/è§†é¢‘/éŸ³é¢‘ï¼‰`;
                    continue;
                }
                
                // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆä¸åŒç±»å‹ä¸åŒé™åˆ¶ï¼‰
                let maxSize = 50 * 1024 * 1024; // é«˜æ¸…å›¾ç‰‡å…è®¸50MB
                if (mediaType === 'video') {
                    maxSize = 500 * 1024 * 1024; // è§†é¢‘å…è®¸500MB
                } else if (mediaType === 'audio') {
                    maxSize = 20 * 1024 * 1024; // éŸ³é¢‘å…è®¸20MB
                }
                
                if (file.size > maxSize) {
                    uploadStatus.textContent = `æ–‡ä»¶ ${file.name} å¤ªå¤§ï¼ˆè¶…è¿‡${maxSize/1024/1024}MBï¼‰`;
                    continue;
                }
                
                try {
                    let mediaData;
                    let thumbnail = '';
                    
                    if (mediaType === 'image') {
                        // é«˜æ¸…å›¾ç‰‡å¤„ç†ï¼šä½¿ç”¨æ›´é«˜çš„åˆ†è¾¨ç‡å’Œè´¨é‡ï¼Œç¡®ä¿é«˜æ¸…ç”»è´¨
                        mediaData = await compressImage(file, 2048, 0.9);
                    } else {
                        // å¯¹äºè§†é¢‘å’ŒéŸ³é¢‘ï¼Œç›´æ¥è¯»å–ä¸ºDataURLï¼Œä½†é™åˆ¶å¤§å°
                        mediaData = await new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(file);
                        });
                        
                        // å¦‚æœæ˜¯è§†é¢‘ï¼Œå¯ä»¥å°è¯•ç”Ÿæˆç¼©ç•¥å›¾
                        if (mediaType === 'video') {
                            try {
                                thumbnail = await generateVideoThumbnail(file);
                            } catch (err) {
                                console.log('ç”Ÿæˆè§†é¢‘ç¼©ç•¥å›¾å¤±è´¥:', err);
                            }
                        }
                    }
                    
                    // æ£€æŸ¥å¤„ç†åçš„å¤§å°
                    // å¯¹äºå¤§æ–‡ä»¶ï¼Œä¸æ£€æŸ¥å¤„ç†åçš„å¤§å°ï¼Œç¡®ä¿é«˜æ¸…å›¾ç‰‡å’Œå¤§è§†é¢‘èƒ½å¤Ÿæ­£å¸¸å¤„ç†
                    if (mediaType !== 'image' && mediaType !== 'video') {
                        const base64Size = Math.round((mediaData.length * 3) / 4); // Base64ç¼–ç å¢åŠ çº¦33%çš„å¤§å°
                        if (base64Size > maxSize * 0.95) { // ç•™å‡º5%çš„ç¼“å†²ç©ºé—´ï¼Œå…è®¸æ›´å¤§çš„æ–‡ä»¶
                            alert(`åª’ä½“æ–‡ä»¶ ${file.name} å¤„ç†åä»ç„¶å¤ªå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¼å…¥å¯¼å‡ºé—®é¢˜ã€‚è¯·ç¡®ä¿æµè§ˆå™¨æœ‰è¶³å¤Ÿçš„å†…å­˜ã€‚`);
                            continue;
                        }
                    }
                    
                    const newMedia = {
                        id: generateId(),
                        url: mediaData,
                        name: file.name,
                        type: mediaType,
                        timestamp: Date.now(),
                        tags: [], // åˆå§‹åŒ–æ ‡ç­¾æ•°ç»„
                        thumbnail: thumbnail // è§†é¢‘ç¼©ç•¥å›¾
                    };
                    
                    album.media.push(newMedia);
                    successfullyAdded++;
                    
                    // è°ƒç”¨ä¿å­˜å‡½æ•°
                    saveMediaToLocalFolder(file, album.id, newMedia.id);
                    
                } catch (error) {
                    console.error('åª’ä½“å¤„ç†å¤±è´¥:', error);
                    uploadStatus.textContent = `å¤„ç†æ–‡ä»¶ ${file.name} æ—¶å‡ºé”™`;
                }
            }
            
            // ä¿å­˜ç›¸å†Œæ•°æ®
            saveAlbums();
            renderMediaList(album.media);
            renderAlbumList(); // æ›´æ–°ç›¸å†Œåˆ—è¡¨ä¸­çš„åª’ä½“æ•°é‡
            uploadStatus.textContent = `æˆåŠŸå¤„ç†å¹¶æ·»åŠ  ${successfullyAdded} ä¸ªåª’ä½“æ–‡ä»¶`;
            
            // æé†’ç”¨æˆ·å…³äºå¯¼å…¥å¯¼å‡ºçš„æ³¨æ„äº‹é¡¹
            if (successfullyAdded > 0 && album.media.length > 20) {
                alert('æç¤ºï¼šç›¸å†Œä¸­çš„åª’ä½“æ–‡ä»¶è¾ƒå¤šï¼Œè¯·æ³¨æ„åœ¨å¯¼å‡ºæ—¶å¯èƒ½ä¼šç”Ÿæˆè¾ƒå¤§çš„æ–‡ä»¶ã€‚');
            }
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤ä¸Šä¼ ç›¸åŒæ–‡ä»¶
            mediaUpload.value = '';
            uploadProgressBar.style.display = 'none';
        }
        
        // ç”Ÿæˆè§†é¢‘ç¼©ç•¥å›¾
        function generateVideoThumbnail(videoFile) {
            return new Promise((resolve, reject) => {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.onloadedmetadata = () => {
                    video.currentTime = 1; // å–ç¬¬1ç§’çš„å¸§ä½œä¸ºç¼©ç•¥å›¾
                };
                
                video.onseeked = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        
                        // ç­‰æ¯”ä¾‹ç¼©å°å¤§è§†é¢‘çš„ç¼©ç•¥å›¾
                        const maxDimension = 300;
                        if (canvas.width > maxDimension || canvas.height > maxDimension) {
                            const ratio = Math.min(maxDimension / canvas.width, maxDimension / canvas.height);
                            canvas.width = canvas.width * ratio;
                            canvas.height = canvas.height * ratio;
                        }
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        
                        // å‹ç¼©ç¼©ç•¥å›¾
                        const thumbnailData = canvas.toDataURL('image/jpeg', 0.7);
                        resolve(thumbnailData);
                    } catch (err) {
                        reject(err);
                    }
                };
                
                video.onerror = reject;
                
                // åˆ›å»ºObjectURLå¹¶è®¾ç½®è§†é¢‘æº
                const objectURL = URL.createObjectURL(videoFile);
                video.src = objectURL;
                
                // æ¸…ç†å‡½æ•°
                const cleanup = () => {
                    URL.revokeObjectURL(objectURL);
                };
                
                // æ­£ç¡®çš„äº‹ä»¶å¤„ç†ï¼Œé¿å…é€’å½’è°ƒç”¨
                const originalSeekedHandler = video.onseeked;
                video.onseeked = function(e) {
                    if (originalSeekedHandler) originalSeekedHandler(e);
                    cleanup();
                };
                
                const originalErrorHandler = video.onerror;
                video.onerror = function(e) {
                    if (originalErrorHandler) originalErrorHandler(e);
                    cleanup();
                };
            });
        }
        
        // æ·»åŠ æ ‡ç­¾åˆ°åª’ä½“
        function addTagToMedia(mediaId, tagText) {
            const album = albums.find(a => a.id === currentAlbumId);
            if (!album || (!album.media && !album.images)) return;
            
            const mediaArray = album.media || album.images;
            const media = mediaArray.find(m => m.id === mediaId);
            
            if (media) {
                // ç¡®ä¿tagsæ•°ç»„å­˜åœ¨
                if (!media.tags) {
                    media.tags = [];
                }
                
                // é¿å…é‡å¤æ ‡ç­¾
                if (!media.tags.includes(tagText)) {
                    media.tags.push(tagText);
                    saveAlbums();
                    renderMediaList(mediaArray);
                    
                    // æ·»åŠ æ ‡ç­¾æ·»åŠ æˆåŠŸçš„å¾®åŠ¨æ•ˆ
                    const mediaElement = document.querySelector(`.media-item[data-id="${mediaId}"]`);
                    if (mediaElement) {
                        mediaElement.classList.add('tag-added-animation');
                        setTimeout(() => {
                            mediaElement.classList.remove('tag-added-animation');
                        }, 600);
                    }
                } else {
                    alert('è¯¥æ ‡ç­¾å·²å­˜åœ¨ï¼');
                }
            }
        }
        
        // ä¿å­˜åª’ä½“åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ - æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘
        // æ³¨æ„ï¼šåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥å†™å…¥æ–‡ä»¶ç³»ç»Ÿåˆ°æŒ‡å®šè·¯å¾„
        // ä½†æˆ‘ä»¬ç¡®ä¿åª’ä½“çš„Base64æ•°æ®æ­£ç¡®ä¿å­˜åœ¨localStorageä¸­ï¼Œä»¥ä¾¿å¯¼å…¥å¯¼å‡ºåŠŸèƒ½æ­£å¸¸å·¥ä½œ
        function saveMediaToLocalFolder(file, albumId, mediaId) {
            // æ­¤å‡½æ•°ä¸å†å°è¯•ç›´æ¥ä¿å­˜æ–‡ä»¶ï¼Œå› ä¸ºæµè§ˆå™¨ç¯å¢ƒé™åˆ¶
            // åª’ä½“æ•°æ®å·²ç»é€šè¿‡Base64æ ¼å¼ä¿å­˜åœ¨album.mediaæ•°ç»„ä¸­
            // æˆ‘ä»¬åªéœ€è¦ç¡®ä¿è¿™ä¸ªæ•°æ®æ­£ç¡®åœ°åŒ…å«åœ¨å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ä¸­
            console.log(`åª’ä½“å·²ä¿å­˜åˆ°ç›¸å†Œæ•°æ®ä¸­: album_${albumId}_media_${mediaId}`);
        }
        
        // åˆ é™¤åª’ä½“
        function deleteMedia(mediaId) {
            console.log('å°è¯•åˆ é™¤åª’ä½“ï¼ŒID:', mediaId);
            
            // é¦–å…ˆéªŒè¯å‚æ•°
            if (!mediaId) {
                console.error('ç¼ºå°‘åª’ä½“ID');
                return;
            }
            
            // æŸ¥æ‰¾å½“å‰ç›¸å†Œ
            const album = albums.find(a => a.id === currentAlbumId);
            if (!album) {
                console.error('æœªæ‰¾åˆ°å½“å‰ç›¸å†Œ');
                return;
            }
            
            // æ£€æŸ¥åª’ä½“æ•°ç»„æ˜¯å¦å­˜åœ¨
            const hasMedia = album.media && album.media.length > 0;
            const hasImages = album.images && album.images.length > 0;
            
            if (!hasMedia && !hasImages) {
                console.log('ç›¸å†Œä¸­æ²¡æœ‰åª’ä½“æ–‡ä»¶');
                return;
            }
            
            // ä½¿ç”¨æ›´æ¸…æ™°çš„ç¡®è®¤å¯¹è¯æ¡†
            const shouldDelete = confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåª’ä½“æ–‡ä»¶å—ï¼Ÿ\n\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼');
            
            // åªæœ‰åœ¨ç”¨æˆ·æ˜ç¡®ç¡®è®¤åæ‰æ‰§è¡Œåˆ é™¤
            if (shouldDelete) {
                console.log('ç”¨æˆ·ç¡®è®¤åˆ é™¤ï¼Œæ‰§è¡Œåˆ é™¤æ“ä½œ');
                
                // æ‰§è¡Œåˆ é™¤é€»è¾‘
                if (hasMedia) {
                    const initialLength = album.media.length;
                    album.media = album.media.filter(m => m.id !== mediaId);
                    console.log(`ä»mediaæ•°ç»„åˆ é™¤: åŸé•¿åº¦=${initialLength}, åˆ é™¤åé•¿åº¦=${album.media.length}`);
                } else if (hasImages) {
                    const initialLength = album.images.length;
                    album.images = album.images.filter(m => m.id !== mediaId);
                    console.log(`ä»imagesæ•°ç»„åˆ é™¤: åŸé•¿åº¦=${initialLength}, åˆ é™¤åé•¿åº¦=${album.images.length}`);
                }
                
                // ä¿å­˜æ›´æ”¹
                saveAlbums();
                console.log('ç›¸å†Œæ•°æ®å·²ä¿å­˜');
                
                // é‡æ–°æ¸²æŸ“åˆ—è¡¨
                const arrayToRender = album.media || album.images || [];
                renderMediaList(arrayToRender);
                renderAlbumList();
                
                console.log('åª’ä½“åˆ—è¡¨å·²æ›´æ–°');
            } else {
                console.log('ç”¨æˆ·å–æ¶ˆäº†åˆ é™¤æ“ä½œï¼Œä¸æ‰§è¡Œä»»ä½•åˆ é™¤');
                // æ˜ç¡®ä¸åšä»»ä½•æ“ä½œ
            }
        }
        
        // å…¨å±€å˜é‡ç”¨äºåª’ä½“æŸ¥çœ‹å™¨
        let currentScale = 1;
        const minScale = 0.5;
        const maxScale = 5;
        const scaleStep = 0.1;
        let currentViewerMedia = null; // å½“å‰æŸ¥çœ‹çš„åª’ä½“å…ƒç´ 
        
        // å°çª—å£æ’­æ”¾è§†é¢‘å‡½æ•°
        // å­˜å‚¨å½“å‰ä½¿ç”¨çš„Blob URLï¼Œæ–¹ä¾¿åç»­é‡Šæ”¾
        let currentBlobUrl = null;
        let isVideoLoading = false; // æ ‡è®°è§†é¢‘æ˜¯å¦æ­£åœ¨åŠ è½½
        
        function openMiniVideoPlayer(media) {
            // å¦‚æœæ­£åœ¨åŠ è½½ï¼Œå…ˆå–æ¶ˆ
            if (isVideoLoading) {
                return;
            }
            
            isVideoLoading = true;
            
            // è®¾ç½®è§†é¢‘æ ‡é¢˜
            miniPlayerTitle.textContent = media.name || 'è§†é¢‘æ’­æ”¾';
            
            // åœæ­¢å½“å‰æ’­æ”¾å¹¶é‡Šæ”¾èµ„æº
            miniPlayerVideo.pause();
            
            // é‡Šæ”¾æ—§çš„Blob URLï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (currentBlobUrl) {
                try {
                    URL.revokeObjectURL(currentBlobUrl);
                } catch (e) {
                    console.error('é‡Šæ”¾æ—§Blob URLå¤±è´¥:', e);
                }
                currentBlobUrl = null;
            }
            
            // æ¸…ç©ºè§†é¢‘æº
            miniPlayerVideo.src = '';
            miniPlayerVideo.load(); // ç¡®ä¿å®Œå…¨é‡ç½®è§†é¢‘å…ƒç´ 
            
            try {
                // å»¶è¿Ÿè®¾ç½®è§†é¢‘æºï¼Œç¡®ä¿è§†é¢‘å…ƒç´ å·²å®Œå…¨é‡ç½®
                setTimeout(() => {
                    try {
                        // å¯¹äºè¾ƒå¤§çš„è§†é¢‘æ–‡ä»¶ï¼Œå°è¯•ä½¿ç”¨Blob URLè€Œä¸æ˜¯DataURL
                        if (media.url.startsWith('data:')) {
                            try {
                                // å°†DataURLè½¬æ¢ä¸ºBlob
                                const byteString = atob(media.url.split(',')[1]);
                                const mimeString = media.url.split(',')[0].split(':')[1].split(';')[0];
                                const ab = new ArrayBuffer(byteString.length);
                                const ia = new Uint8Array(ab);
                                for (let i = 0; i < byteString.length; i++) {
                                    ia[i] = byteString.charCodeAt(i);
                                }
                                const blob = new Blob([ab], { type: mimeString });
                                // åˆ›å»ºBlob URLå¹¶ä¿å­˜å¼•ç”¨
                                currentBlobUrl = URL.createObjectURL(blob);
                                
                                // æ·»åŠ é”™è¯¯å¤„ç†äº‹ä»¶
                                miniPlayerVideo.onerror = function(e) {
                                    console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e);
                                    // å¦‚æœæ˜¯Blob URLé”™è¯¯ï¼Œå°è¯•ç›´æ¥ä½¿ç”¨DataURL
                                    if (currentBlobUrl) {
                                        try {
                                            URL.revokeObjectURL(currentBlobUrl);
                                        } catch (revokeErr) {
                                            console.error('é‡Šæ”¾é”™è¯¯çš„Blob URLå¤±è´¥:', revokeErr);
                                        }
                                        currentBlobUrl = null;
                                        miniPlayerVideo.src = media.url;
                                        miniPlayerVideo.load();
                                    }
                                };
                                
                                miniPlayerVideo.src = currentBlobUrl;
                                miniPlayerVideo.load();
                            } catch (e) {
                                console.error('è½¬æ¢DataURLå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹URL:', e);
                                // è½¬æ¢å¤±è´¥æ—¶å›é€€åˆ°ç›´æ¥ä½¿ç”¨DataURL
                                miniPlayerVideo.src = media.url;
                                miniPlayerVideo.load();
                            }
                        } else {
                            miniPlayerVideo.src = media.url;
                            miniPlayerVideo.load();
                        }
                        
                        // æ˜¾ç¤ºå°çª—å£æ’­æ”¾å™¨
                        miniVideoPlayer.style.display = 'flex';
                        document.body.style.overflow = 'hidden'; // ç¦æ­¢é¡µé¢æ»šåŠ¨
                        
                        // å°è¯•æ’­æ”¾è§†é¢‘
                        setTimeout(() => {
                            miniPlayerVideo.play().catch(error => {
                                console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:', error);
                            });
                        }, 100);
                        
                        isVideoLoading = false;
                    } catch (innerError) {
                        console.error('è®¾ç½®è§†é¢‘æºå¤±è´¥:', innerError);
                        isVideoLoading = false;
                        return false;
                    }
                }, 50);
                
                return true; // è¡¨ç¤ºä½¿ç”¨äº†å°çª—å£æ’­æ”¾å™¨
            } catch (error) {
                console.error('æ’­æ”¾è§†é¢‘å¤±è´¥:', error);
                isVideoLoading = false;
                return false; // è¡¨ç¤ºæ’­æ”¾å¤±è´¥ï¼Œå¯èƒ½éœ€è¦å›é€€åˆ°åŸå§‹æ–¹å¼
            }
        }
        
        // æ‰“å¼€åª’ä½“æŸ¥çœ‹å™¨
        function openMediaViewer(mediaItems) {
            if (!mediaItems || mediaItems.length === 0) return;
            
            // é‡ç½®ç¼©æ”¾æ¯”ä¾‹
            currentScale = 1;
            
            updateViewerMedia(mediaItems);
            
            // æ·»åŠ æ‰“å¼€åŠ¨ç”»æ•ˆæœ
            imageViewer.style.opacity = '0';
            imageViewer.style.display = 'flex';
            
            // ä½¿ç”¨requestAnimationFrameç¡®ä¿åŠ¨ç”»æµç•…
            requestAnimationFrame(() => {
                imageViewer.style.transition = 'opacity 0.3s ease';
                imageViewer.style.opacity = '1';
                document.body.style.overflow = 'hidden'; // ç¦æ­¢é¡µé¢æ»šåŠ¨
            });
        }
        
        // æ›´æ–°æŸ¥çœ‹å™¨ä¸­çš„åª’ä½“
        function updateViewerMedia(mediaItems) {
            const currentMedia = mediaItems[currentImageIndex];
            if (!currentMedia) return;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºè§†é¢‘ï¼Œä½¿ç”¨å°çª—å£æ’­æ”¾å™¨
            const mediaType = currentMedia.type || (currentMedia.url.includes('data:image/') ? 'image' : 
                             currentMedia.url.includes('data:video/') ? 'video' : 
                             currentMedia.url.includes('data:audio/') ? 'audio' : 'image');
            
            // å¦‚æœæ˜¯è§†é¢‘ï¼Œä½¿ç”¨å°çª—å£æ’­æ”¾
            if (mediaType === 'video') {
                // å…³é—­åª’ä½“æŸ¥çœ‹å™¨
                closeMediaViewer();
                // ä½¿ç”¨å°çª—å£æ’­æ”¾è§†é¢‘
                openMiniVideoPlayer(currentMedia);
                return; // æå‰è¿”å›ï¼Œé¿å…ç»§ç»­æ‰§è¡Œ
            }
            
            // ç§»é™¤ä¹‹å‰çš„åª’ä½“å…ƒç´ ï¼ˆå®‰å…¨æ£€æŸ¥ï¼‰
            if (currentViewerMedia && viewerContent.contains(currentViewerMedia)) {
                viewerContent.removeChild(currentViewerMedia);
                currentViewerMedia = null;
            }
            
            // é‡ç½®ç¼©æ”¾å’Œè½¬æ¢
            viewerContent.style.transform = 'scale(1)';
            
            // åˆ›å»ºå¹¶è®¾ç½®åª’ä½“å…ƒç´ 
            if (mediaType === 'image') {
                currentViewerMedia = document.createElement('img');
                currentViewerMedia.src = currentMedia.url;
                currentViewerMedia.alt = currentMedia.name || 'åª’ä½“æ–‡ä»¶';
                currentViewerMedia.className = 'viewer-media-image';
            } else if (mediaType === 'video') {
                // æ”¹è¿›è§†é¢‘å¤„ç†é€»è¾‘ï¼Œç¡®ä¿è§†é¢‘èƒ½å¤Ÿæ­£å¸¸æ’­æ”¾
                currentViewerMedia = document.createElement('video');
                
                // ä¸‹é¢æ˜¯è§†é¢‘å¤„ç†é€»è¾‘ï¼Œç”±updateViewerMediaå‡½æ•°ç»Ÿä¸€ç®¡ç†
                /*
                // å¯¹äºè¾ƒå¤§çš„è§†é¢‘æ–‡ä»¶ï¼Œå°è¯•ä½¿ç”¨Blob URLè€Œä¸æ˜¯DataURL
                try {
                    // æ£€æŸ¥æ˜¯å¦ä¸ºDataURL
                    if (currentMedia.url.startsWith('data:')) {
                        // å°†DataURLè½¬æ¢ä¸ºBlob
                        const byteString = atob(currentMedia.url.split(',')[1]);
                        const mimeString = currentMedia.url.split(',')[0].split(':')[1].split(';')[0];
                        const ab = new ArrayBuffer(byteString.length);
                        const ia = new Uint8Array(ab);
                        for (let i = 0; i < byteString.length; i++) {
                            ia[i] = byteString.charCodeAt(i);
                        }
                        const blob = new Blob([ab], { type: mimeString });
                        // åˆ›å»ºBlob URL
                        currentViewerMedia.src = URL.createObjectURL(blob);
                    } else {
                        currentViewerMedia.src = currentMedia.url;
                    }
                } catch (e) {
                    console.error('å¤„ç†è§†é¢‘URLå¤±è´¥:', e);
                    currentViewerMedia.src = currentMedia.url; // å›é€€åˆ°åŸå§‹URL
                }
                
                currentViewerMedia.controls = true;
                currentViewerMedia.className = 'viewer-media-video';
                currentViewerMedia.autoplay = false; // é¿å…è‡ªåŠ¨æ’­æ”¾
                currentViewerMedia.preload = 'metadata'; // ä»…é¢„åŠ è½½å…ƒæ•°æ®ä»¥æé«˜æ€§èƒ½
                */
            } else if (mediaType === 'audio') {
                currentViewerMedia = document.createElement('audio');
                currentViewerMedia.src = currentMedia.url;
                currentViewerMedia.controls = true;
                currentViewerMedia.className = 'viewer-media-audio';
            }
            
            viewerContent.appendChild(currentViewerMedia);
            
            // ä¸ºè§†é¢‘æ·»åŠ åŠ è½½äº‹ä»¶å¤„ç†
            if (mediaType === 'video') {
                currentViewerMedia.addEventListener('error', (e) => {
                    console.error('è§†é¢‘åŠ è½½å¤±è´¥:', e);
                    imageCaption.textContent = `åŠ è½½å¤±è´¥: ${currentMedia.name || mediaType}`;
                });
                
                // æ¸…ç†Blob URLä»¥é¿å…å†…å­˜æ³„æ¼
                currentViewerMedia.onended = function() {
                    if (this.src.startsWith('blob:')) {
                        URL.revokeObjectURL(this.src);
                    }
                };
            }
            
            // æ›´æ–°æ ‡é¢˜
            imageCaption.textContent = `${formatDate(currentMedia.timestamp)} - ${currentMedia.name || mediaType}`;
            
            // æ˜¾ç¤ºæ ‡ç­¾
            const tagsContainer = document.createElement('div');
            tagsContainer.className = 'viewer-tags';
            
            if (currentMedia.tags && currentMedia.tags.length > 0) {
                currentMedia.tags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'tag';
                    tagElement.textContent = tag;
                    tagsContainer.appendChild(tagElement);
                });
            } else {
                tagsContainer.textContent = 'æ— æ ‡ç­¾';
                tagsContainer.classList.add('no-tags');
            }
            
            // æ›¿æ¢æ—§çš„æ ‡ç­¾å®¹å™¨
            const oldTagsContainer = viewerContent.querySelector('.viewer-tags');
            if (oldTagsContainer) {
                viewerContent.removeChild(oldTagsContainer);
            }
            viewerContent.appendChild(tagsContainer);
            
            // æ˜¾ç¤º/éšè—å¯¼èˆªæŒ‰é’®
            prevImage.style.display = currentImageIndex > 0 ? 'block' : 'none';
            nextImage.style.display = currentImageIndex < mediaItems.length - 1 ? 'block' : 'none';
        }
        
        // å…³é—­åª’ä½“æŸ¥çœ‹å™¨
        function closeMediaViewer() {
            // æ·»åŠ å…³é—­åŠ¨ç”»æ•ˆæœ
            imageViewer.style.transition = 'opacity 0.3s ease';
            imageViewer.style.opacity = '0';
            
            setTimeout(() => {
                imageViewer.style.display = 'none';
                document.body.style.overflow = 'auto'; // æ¢å¤é¡µé¢æ»šåŠ¨
                
                // åœæ­¢å½“å‰åª’ä½“æ’­æ”¾
                if (currentViewerMedia) {
                    if (currentViewerMedia.pause) {
                        currentViewerMedia.pause();
                    }
                    viewerContent.removeChild(currentViewerMedia);
                    currentViewerMedia = null;
                }
            }, 300);
        }
        
        // æŸ¥çœ‹ä¸Šä¸€ä¸ªåª’ä½“
        function showPrevMedia() {
            const album = albums.find(a => a.id === currentAlbumId);
            const mediaArray = album?.media || album?.images;
            
            if (mediaArray && currentImageIndex > 0) {
                currentImageIndex--;
                
                // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
                viewerContent.style.transition = 'transform 0.3s ease';
                viewerContent.style.transform = 'translateX(-100%) scale(0.95)';
                
                setTimeout(() => {
                    updateViewerMedia(mediaArray);
                    viewerContent.style.transform = 'translateX(100%) scale(0.95)';
                    
                    setTimeout(() => {
                        viewerContent.style.transform = 'translateX(0) scale(1)';
                    }, 50);
                }, 300);
            }
        }
        
        // æŸ¥çœ‹ä¸‹ä¸€ä¸ªåª’ä½“
        function showNextMedia() {
            const album = albums.find(a => a.id === currentAlbumId);
            const mediaArray = album?.media || album?.images;
            
            if (mediaArray && currentImageIndex < mediaArray.length - 1) {
                currentImageIndex++;
                
                // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
                viewerContent.style.transition = 'transform 0.3s ease';
                viewerContent.style.transform = 'translateX(100%) scale(0.95)';
                
                setTimeout(() => {
                    updateViewerMedia(mediaArray);
                    viewerContent.style.transform = 'translateX(-100%) scale(0.95)';
                    
                    setTimeout(() => {
                        viewerContent.style.transform = 'translateX(0) scale(1)';
                    }, 50);
                }, 300);
            }
        }
        
        // å¤„ç†åª’ä½“ç¼©æ”¾ - åªå¯¹å›¾ç‰‡å’Œè§†é¢‘åº”ç”¨
        function handleMediaZoom(event) {
            event.preventDefault();
            
            // åªå¯¹å›¾ç‰‡å’Œè§†é¢‘åº”ç”¨ç¼©æ”¾
            if (currentViewerMedia && (currentViewerMedia.tagName === 'IMG' || currentViewerMedia.tagName === 'VIDEO')) {
                // ç¡®å®šç¼©æ”¾æ–¹å‘
                const delta = event.deltaY > 0 ? -scaleStep : scaleStep;
                
                // è®¡ç®—æ–°çš„ç¼©æ”¾æ¯”ä¾‹
                const newScale = Math.max(minScale, Math.min(maxScale, currentScale + delta));
                
                // åº”ç”¨ç¼©æ”¾
                currentScale = newScale;
                currentViewerMedia.style.transform = `scale(${currentScale})`;
            }
        }
        
        // é‡ç½®åª’ä½“ç¼©æ”¾
        function resetMediaZoom() {
            currentScale = 1;
            if (currentViewerMedia) {
                currentViewerMedia.style.transform = 'scale(1)';
            }
        }
        
        // åˆ é™¤ç›¸å†Œ
        function deleteAlbum(albumId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç›¸å†Œå—ï¼Ÿåˆ é™¤åæ‰€æœ‰ç¥ç¦ä¿¡æ¯å’Œç…§ç‰‡ä¹Ÿå°†ä¸¢å¤±ã€‚')) {
                albums = albums.filter(a => a.id !== albumId);
                saveAlbums();
                renderAlbumList();
            }
        }
        
        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            localStorage.setItem('darkTheme', isDarkTheme);
            initTheme();
        }
        
        // å¯¼å‡ºæ•°æ® - å¢å¼ºç‰ˆ
        function exportData() {
            try {
                // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®å¯å¯¼å‡º
                if (albums.length === 0) {
                    alert('å½“å‰æ²¡æœ‰ç›¸å†Œæ•°æ®å¯å¯¼å‡º');
                    return;
                }
                
                // åˆ›å»ºå¯¼å‡ºæ•°æ®çš„å‰¯æœ¬ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
                const exportData = JSON.parse(JSON.stringify(albums));
                
                // ä¼˜åŒ–å¤§å‹Base64å›¾ç‰‡çš„å¯¼å‡ºå¤„ç†
                // å¦‚æœæœ‰å¤§é‡æˆ–å¤§å‹å›¾ç‰‡ï¼Œå¯èƒ½éœ€è¦åˆ†æ‰¹å¤„ç†
                // æ£€æŸ¥æ•°æ®å¤§å°
                const dataStr = JSON.stringify(exportData, null, 2);
                
                // æ£€æŸ¥æ•°æ®å¤§å°ï¼Œå¦‚æœå¤ªå¤§å¯èƒ½å¯¼è‡´é—®é¢˜
                if (dataStr.length > 10 * 1024 * 1024) { // 10MB
                    alert('è­¦å‘Šï¼šå¯¼å‡ºçš„æ•°æ®è¾ƒå¤§ï¼ˆè¶…è¿‡10MBï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨æ€§èƒ½é—®é¢˜æˆ–å¯¼å…¥å¤±è´¥ã€‚å»ºè®®å‡å°‘ç›¸å†Œä¸­çš„å›¾ç‰‡æ•°é‡æˆ–å¤§å°ã€‚');
                }
                
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                // ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶å
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const exportFileDefaultName = `memory-albums-${timestamp}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                
                // æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½
                document.body.appendChild(linkElement);
                linkElement.click();
                document.body.removeChild(linkElement);
                
                console.log('ç›¸å†Œæ•°æ®å¯¼å‡ºæˆåŠŸ');
                alert(`æˆåŠŸå¯¼å‡º${albums.length}ä¸ªç›¸å†Œï¼è¯·å¦¥å–„ä¿å­˜å¯¼å‡ºçš„JSONæ–‡ä»¶ã€‚`);
            } catch (error) {
                console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
                alert('å¯¼å‡ºæ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚å¦‚æœé—®é¢˜æŒç»­ï¼Œå¯èƒ½æ˜¯å› ä¸ºç›¸å†Œä¸­åŒ…å«è¿‡å¤§çš„å›¾ç‰‡æ•°æ®ã€‚');
            }
        }
        
        // å¯¼å…¥æ•°æ® - å¢å¼ºç‰ˆ
        function importData(file) {
            if (!file) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå¯¼å…¥');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (file.type && file.type !== 'application/json') {
                alert('è¯·é€‰æ‹©JSONæ ¼å¼çš„æ–‡ä»¶');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedAlbums = JSON.parse(e.target.result);
                    
                    // éªŒè¯å¯¼å…¥æ•°æ®çš„æ ¼å¼
                    if (!Array.isArray(importedAlbums)) {
                        alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œé¢„æœŸæ˜¯ç›¸å†Œæ•°ç»„');
                        return;
                    }
                    
                    // å¢å¼ºçš„éªŒè¯é€»è¾‘ï¼Œç¡®ä¿åŒ…å«å¿…è¦çš„æ•°ç»„å­—æ®µ
                    const validAlbums = importedAlbums.every(album => {
                        if (!(album && typeof album === 'object' && 
                            typeof album.id === 'string' && 
                            typeof album.name === 'string')) {
                            return false;
                        }
                        
                        // ç¡®ä¿timestampå­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ 
                        if (typeof album.timestamp !== 'number') {
                            album.timestamp = Date.now();
                        }
                        
                        // ç¡®ä¿messagesæ•°ç»„å­˜åœ¨
                        if (!Array.isArray(album.messages)) {
                            album.messages = [];
                        }
                        
                        // ç¡®ä¿imagesæ•°ç»„å­˜åœ¨
                        if (!Array.isArray(album.images)) {
                            album.images = [];
                        }
                        
                        return true;
                    });
                    
                    if (!validAlbums) {
                        alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶åŒ…å«æ— æ•ˆçš„ç›¸å†Œæ•°æ®ç»“æ„');
                        return;
                    }
                    
                    // å¤„ç†å¯èƒ½çš„å¤§å‹Base64å­—ç¬¦ä¸²å¯¼å…¥é—®é¢˜
                    try {
                        // å°è¯•åºåˆ—åŒ–ä¸€æ¬¡ä»¥ç¡®ä¿æ•°æ®å¯ä»¥è¢«ä¿å­˜
                        JSON.stringify(importedAlbums);
                    } catch (serializationError) {
                        console.error('æ•°æ®åºåˆ—åŒ–å¤±è´¥:', serializationError);
                        alert('å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ ¼å¼æ­£ç¡®ä½†åŒ…å«æ— æ³•å¤„ç†çš„å†…å®¹ï¼ˆå¯èƒ½æ˜¯è¶…å¤§çš„å›¾ç‰‡æ•°æ®ï¼‰');
                        return;
                    }
                    
                    if (confirm(`å¯¼å…¥å°†è¦†ç›–å½“å‰çš„${albums.length}ä¸ªç›¸å†Œï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`)) {
                        albums = importedAlbums;
                        saveAlbums();
                        renderAlbumList();
                        
                        // å…³é—­å¯èƒ½æ‰“å¼€çš„ç›¸å†Œæ¨¡æ€æ¡†
                        albumModal.style.display = 'none';
                        currentAlbumId = null;
                        
                        alert(`æˆåŠŸå¯¼å…¥${albums.length}ä¸ªç›¸å†Œï¼`);
                    }
                } catch (error) {
                    console.error('å¯¼å…¥æ•°æ®è§£æå¤±è´¥:', error);
                    alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®æˆ–å†…å®¹æŸå');
                }
            };
            
            reader.onerror = () => {
                alert('è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•');
            };
            
            reader.readAsText(file);
        }
        
        // æ›´æ–°ç›¸å†Œåç§°
        function updateAlbumName() {
            const album = albums.find(a => a.id === currentAlbumId);
            if (!album) return;
            
            const newName = modalAlbumTitle.value.trim();
            if (!newName) {
                alert('ç›¸å†Œåç§°ä¸èƒ½ä¸ºç©º');
                modalAlbumTitle.value = album.name;
                return;
            }
            
            album.name = newName;
            saveAlbums();
            renderAlbumList();
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        createAlbumBtn.addEventListener('click', createAlbum);
        closeModal.addEventListener('click', () => {
            albumModal.style.display = 'none';
            currentAlbumId = null;
        });
        addMessageBtn.addEventListener('click', addMessage);
        mediaUpload.addEventListener('change', handleMediaUpload);
        themeToggle.addEventListener('click', toggleTheme);
        
        // å¯¼å‡ºæ•°æ®æŒ‰é’®äº‹ä»¶
        exportBtn.addEventListener('click', function() {
            // æ˜¾ç¤ºå¯¼å‡ºç¡®è®¤æç¤º
            if (albums.length > 0) {
                const exportConfirm = confirm(`ç¡®å®šè¦å¯¼å‡º${albums.length}ä¸ªç›¸å†Œçš„æ•°æ®å—ï¼Ÿ`);
                if (exportConfirm) {
                    exportData();
                }
            } else {
                exportData(); // ä¼šæ˜¾ç¤ºæ²¡æœ‰æ•°æ®çš„æç¤º
            }
        });
        
        // å¯¼å…¥æ•°æ®æ–‡ä»¶è¾“å…¥äº‹ä»¶
        importInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                importData(e.target.files[0]);
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
                e.target.value = '';
            }
        });
        
        // ç¡®ä¿å¯¼å…¥æ•°æ®æ ‡ç­¾ç‚¹å‡»æ—¶èƒ½è§¦å‘æ–‡ä»¶é€‰æ‹©
        const importLabel = document.querySelector('label[for="importInput"]');
        if (importLabel) {
            importLabel.addEventListener('click', function() {
                // ç›´æ¥ç‚¹å‡»æ–‡ä»¶è¾“å…¥å…ƒç´ 
                importInput.click();
            });
        }
        modalAlbumTitle.addEventListener('blur', updateAlbumName);
        modalAlbumTitle.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                modalAlbumTitle.blur();
            }
        });
        // åª’ä½“æŸ¥çœ‹å™¨äº‹ä»¶
        closeViewer.addEventListener('click', closeMediaViewer);
        
        // å…³é—­å°çª—å£è§†é¢‘æ’­æ”¾å™¨æŒ‰é’®äº‹ä»¶
        closeMiniPlayer.addEventListener('click', function() {
            // é‡ç½®åŠ è½½æ ‡å¿—
            isVideoLoading = false;
            
            // åœæ­¢è§†é¢‘æ’­æ”¾
            miniPlayerVideo.pause();
            
            // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
            miniPlayerVideo.onerror = null;
            
            // é‡Šæ”¾è§†é¢‘èµ„æº
            miniPlayerVideo.src = '';
            miniPlayerVideo.load();
            
            // ä½¿ç”¨ç»Ÿä¸€çš„Blob URLç®¡ç†æ–¹å¼é‡Šæ”¾èµ„æº
            if (currentBlobUrl) {
                try {
                    URL.revokeObjectURL(currentBlobUrl);
                } catch (e) {
                    console.error('å…³é—­æ—¶é‡Šæ”¾Blob URLå¤±è´¥:', e);
                }
                currentBlobUrl = null;
            }
            
            // éšè—å°çª—å£æ’­æ”¾å™¨
            miniVideoPlayer.style.display = 'none';
            document.body.style.overflow = ''; // æ¢å¤é¡µé¢æ»šåŠ¨
        });
        
        // ç‚¹å‡»å°çª—å£å¤–éƒ¨å…³é—­
        miniVideoPlayer.addEventListener('click', function(event) {
            if (event.target === miniVideoPlayer) {
                closeMiniPlayer.click();
            }
        });
        
        // ESCé”®å…³é—­å°çª—å£
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && miniVideoPlayer.style.display === 'flex') {
                closeMiniPlayer.click();
            }
        });
        prevImage.addEventListener('click', showPrevMedia);
        nextImage.addEventListener('click', showNextMedia);
        
        // æ·»åŠ é¼ æ ‡æ»šè½®ç¼©æ”¾äº‹ä»¶ç›‘å¬å™¨ - ç›‘å¬viewerContentè€Œä¸æ˜¯ç‰¹å®šåª’ä½“å…ƒç´ 
        viewerContent.addEventListener('wheel', handleMediaZoom);
        
        // ç‚¹å‡»åª’ä½“é‡ç½®ç¼©æ”¾
        viewerContent.addEventListener('click', function(e) {
            // åªæœ‰ç‚¹å‡»åª’ä½“å…ƒç´ æœ¬èº«æ—¶æ‰é‡ç½®ç¼©æ”¾
            if (currentViewerMedia && e.target === currentViewerMedia) {
                resetMediaZoom();
            }
        });
        
        // ç‚¹å‡»æŸ¥çœ‹å™¨èƒŒæ™¯å…³é—­
        imageViewer.addEventListener('click', (e) => {
            if (e.target === imageViewer) {
                closeMediaViewer();
            }
        });
        
        // é”®ç›˜å¯¼èˆª
        document.addEventListener('keydown', (e) => {
            if (imageViewer.style.display === 'flex') {
                switch (e.key) {
                    case 'Escape':
                        closeMediaViewer();
                        break;
                    case 'ArrowLeft':
                        showPrevMedia();
                        break;
                    case 'ArrowRight':
                        showNextMedia();
                        break;
                }
            }
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', (e) => {
            if (e.target === albumModal) {
                albumModal.style.display = 'none';
                currentAlbumId = null;
            }
        });
        
        // ç”Ÿæˆéšæœºçˆ±å¿ƒè£…é¥°
        function generateHeartDecorations(container, count, minSize, maxSize) {
            for (let i = 0; i < count; i++) {
                const heart = document.createElement('div');
                heart.classList.add('heart-decoration');
                
                // éšæœºå¤§å°
                const size = Math.random() * (maxSize - minSize) + minSize;
                heart.style.width = `${size}px`;
                heart.style.height = `${size}px`;
                
                // éšæœºä½ç½®
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                heart.style.left = `${left}%`;
                heart.style.top = `${top}%`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿå’ŒæŒç»­æ—¶é—´
                const delay = Math.random() * 5;
                const duration = 5 + Math.random() * 10;
                heart.style.animation = `floatHeart ${duration}s ease-in-out ${delay}s infinite`;
                
                container.appendChild(heart);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåç”Ÿæˆçˆ±å¿ƒè£…é¥°
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºå¤´éƒ¨ç”Ÿæˆçˆ±å¿ƒè£…é¥°
            const headerContainer = document.querySelector('.header-hearts');
            if (headerContainer) {
                generateHeartDecorations(headerContainer, 15, 20, 60);
            }
        });
        
        // æ›´æ–°å½“å‰æ—¶é—´
        function updateCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('currentTime').textContent = `${year}-${month}-${day} ${hours}:${minutes}`;
        }
        
        // åˆå§‹åŒ–é¡µé¢
        initTheme();
        renderAlbumList();
        updateCurrentTime(); // åˆå§‹æ›´æ–°æ—¶é—´
        setInterval(updateCurrentTime, 60000); // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
    </script>
    <style>
        .current-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            background-color: var(--bg-secondary);
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin: 0.75rem 0;
            display: inline-block;
        }
        
        /* å¾®åŠ¨æ•ˆæ ·å¼ */
        .btn, button {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover, button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active, button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .media-item {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            width: 100%;
            display: block; /* æ”¹ä¸ºå—çº§å…ƒç´  */
            margin-bottom: 5px;
        }
        
        /* åª’ä½“å†…å®¹å®¹å™¨ - ä¿æŒæ­£æ–¹å½¢ */
        .media-content {
            aspect-ratio: 1/1; /* å›ºå®šå®½é«˜æ¯”ä¸ºæ­£æ–¹å½¢ */
            overflow: hidden;
            width: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* å“åº”å¼å¸ƒå±€è°ƒæ•´ */
        @media (max-width: 768px) {
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
        
        /* å›¾ç‰‡å’Œè§†é¢‘åœ¨åª’ä½“é¡¹ä¸­ç­‰æ¯”ä¾‹ç¼©æ”¾ */
        .media-item img,
        .media-item video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* ç­‰æ¯”ä¾‹ç¼©æ”¾å¹¶å¡«å……å®¹å™¨ */
            transition: transform 0.3s ease;
        }
        
        /* è§†é¢‘åŒ…è£…å™¨æ ·å¼ */
        .video-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* åˆ é™¤æŒ‰é’®æ ·å¼ */
        .delete-media {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background-color: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
            line-height: 1;
        }
        
        /* æ ‡ç­¾æŒ‰é’®æ ·å¼ */
        .add-tag-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background-color: rgba(52, 152, 219, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
            line-height: 1;
        }
        
        /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæŒ‰é’® */
        .media-item:hover .delete-media,
        .media-item:hover .add-tag-btn {
            opacity: 1;
        }
        
        /* æ ‡ç­¾å®¹å™¨æ ·å¼ - ç§»åˆ°å›¾ç‰‡ä¸Šæ–¹ */
        .tags-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 5px;
            background: transparent;
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            z-index: 5;
            pointer-events: none;
        }
        
        .tag {
            pointer-events: all;
        }
        
        .tag {
            background-color: rgba(52, 152, 219, 0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            margin-right: 3px;
            margin-bottom: 3px;
        }
        
        .media-item:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .album-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .album-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .tag {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .tag:hover {
            transform: scale(1.1);
            background-color: var(--primary-color);
            color: white;
        }
        
        /* å¹³æ»‘æ»šåŠ¨ */
        html {
            scroll-behavior: smooth;
        }
        
        /* è¾“å…¥æ¡†ç„¦ç‚¹åŠ¨ç”» */
        input[type="text"], textarea {
            transition: all 0.2s ease;
        }
        
        input[type="text"]:focus, textarea:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
        
        /* æ¨¡æ€æ¡†è¿‡æ¸¡æ•ˆæœ */
        .modal {
            transition: all 0.3s ease;
        }
        
        /* æ ‡ç­¾åŠ¨ç”» */
        .tag {
            position: relative;
            display: inline-block;
            margin: 2px;
            padding: 4px 8px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.05);
            font-size: 0.8em;
        }
        
        /* åª’ä½“æŸ¥çœ‹å™¨ä¸­çš„åª’ä½“å…ƒç´ æ ·å¼ */
        .viewer-media-image, .viewer-media-video {
            max-width: 90vw;
            max-height: 80vh;
            object-fit: contain;
            transition: transform 0.2s ease;
            display: block;
            margin: 0 auto;
        }
        
        .viewer-media-audio {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
        }
    </style>
</body>
</html>
